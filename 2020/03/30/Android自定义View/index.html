


<!DOCTYPE html>
<html lang="en,zh-CN,ja,default">
<head>
  <meta charset="UTF-8">
  <title>Android自定义View [ hiaoyun-en ]</title>
  
  
    <!-- stylesheets list from _config.yml -->
    
      <!-- 引入 CSS -->
      <link rel="stylesheet" href="/css/noise.css">
    
      <!-- 引入 CSS -->
      <link rel="stylesheet" href="/lib/fontawesome-free-5.11.2-web/css/all.css">
    
      <!-- 引入 CSS -->
      <link rel="stylesheet" href="/lib/highlight/styles/atom-one-dark.css">
    
  
<meta name="generator" content="Hexo 4.2.0"></head>
<body>

<!-- 引入导航菜单 -->
 
<!-- 导航菜单 -->
<div id="menu-outer">
    <div id="menu-inner">
        
        <span id="menu-link-icon">
            <a href="/">Home</a>
        </span>
        
        <span id="menu-link-icon">
            <a href="/archives">Archives</a>
        </span>
        
        <span id="menu-link-icon">
            <a href="/about">About</a>
        </span>
        
    </div>
</div>
 

<div id="content-outer">
  <div id="content-inner">
     
<article id="post">
  <h1>Android自定义View</h1>
  <p>自定义 View 有两种方法：</p>
<p>继承 <code>View</code> 的子类，如<code>TextView</code>；</p>
<p>直接继承 <code>View</code> 类。需要自己绘制 UI 元素。</p>
<a id="more"></a>

<h2 id="继承-View-的子类"><a href="#继承-View-的子类" class="headerlink" title="继承 View 的子类"></a>继承 View 的子类</h2><p>重写一些方法。</p>
<h2 id="直接继承-View"><a href="#直接继承-View" class="headerlink" title="直接继承 View"></a>直接继承 View</h2><p><code>onSizeChanged()</code></p>
<p><code>onDraw()</code></p>
<p>绘制 View 的形状、样式。</p>
<p><code>invalidate()</code></p>
<p>重绘 View。</p>
<p>为优化性能，在<code>onDraw()</code>方法执行前分配变量，指定所需要的值。</p>
<p>重写<code>performClick()</code>来提供点击事件。</p>
<h2 id="使用自定义-View"><a href="#使用自定义-View" class="headerlink" title="使用自定义 View"></a>使用自定义 View</h2><p>就像自带的 View 一样使用。</p>
<h2 id="自定义属性"><a href="#自定义属性" class="headerlink" title="自定义属性"></a>自定义属性</h2><p>新建<code>value/attrs.xml</code>：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;
    &lt;declare-styleable name=&quot;DialView&quot;&gt;
        &lt;attr name=&quot;fanColor1&quot; format=&quot;color&quot; /&gt;
        &lt;attr name=&quot;fanColor2&quot; format=&quot;color&quot; /&gt;
        &lt;attr name=&quot;fanColor3&quot; format=&quot;color&quot; /&gt;
    &lt;/declare-styleable&gt;
&lt;/resources&gt;</code></pre>
<p><code>name</code>建议为自定义 View 类的名称。</p>
<p>布局 XML 中，赋值：</p>
<pre><code class="xml">app:fanColor1=&quot;#FFEB3B&quot;
app:fanColor2=&quot;#CDDC39&quot;
app:fanColor3=&quot;#009688&quot;</code></pre>
<p>自定义 View 类中，获得值：</p>
<pre><code class="kotlin">        context.withStyledAttributes(attrs, R.styleable.DialView) {
            fanSpeedLowColor = getColor(R.styleable.DialView_fanColor1, 0)
            fanSpeedMediumColor = getColor(R.styleable.DialView_fanColor2, 0)
            fanSpeedMaxColor = getColor(R.styleable.DialView_fanColor3, 0)
        }</code></pre>
<blockquote>
<p><code>withStyledAttributes()</code>报错：</p>
<p><code>Cannot inline bytecode built with JVM target 1.8 into bytecode that is being built with JVM target 1.6</code></p>
<p>解决：<code>app/build.gradle</code>:</p>
<pre><code class="groovy">android {
 ...
 compileOptions {
     sourceCompatibility JavaVersion.VERSION_1_8
     targetCompatibility JavaVersion.VERSION_1_8
 }

 kotlinOptions {
     jvmTarget = JavaVersion.VERSION_1_8.toString()
 }
}</code></pre>
</blockquote>

</article>

<div id="paginator">
  
</div>

  </div>
</div>

<div id="bottom-outer">
    <div id="bottom-inner">
        Site by Aoyun using
        <a href="http://hexo.io" target="_blank" rel="noopener">hexo blog framework</a>.
        <br>
        <a href="/">Home</a>
    </div>
</div> 
<button class="back-to-top">↑</button>

<!-- 引入 JS -->
<script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.min.js"></script>

  <!-- scripts list from theme config.yml -->
  
    <script src="/js/noise.js"></script>
  
    <script src="/lib/highlight/highlight.pack.js"></script>
  


<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
